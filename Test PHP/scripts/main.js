!function(){function a(){var a=this,b=this.getData();this.mainMenuCounter=$(".main-nav .call-modal"),this.basketTitleCounter=$("#basket-goods-counter"),this.goodsCount=b.count,this.goods=$.isEmptyObject(b.goods)?{}:JSON.parse(b.goods),$.isEmptyObject(this.goods)||$.each(this.goods,function(){a.add(this.id,this.image,this.title,this.subtitle,this.size,this.pillowcasesCount,this.isGum,this.count,this.price,this.originPrice,!0),$('.goods-item[data-id="'+this.id+'"]').addClass("picked"),$('.good-content-section[data-id="'+this.id+'" ] .order-btn').addClass("order-btn-dis")}),$(".basket-link, .order-btn").click(function(b){var c={pillowcasesCount:2,size:1,isGum:!1,count:1},d=$(this).parents(".goods-item"),e=$(this).parents(".goods-container"),f=$('.basket-goods .item-good[data-id="'+d.attr("data-id")+'"]'),g=$('.basket-goods .item-good[data-id="'+e.attr("data-id")+'"]');return b.preventDefault(),$(this).parents(".goods-item").hasClass("picked")||$(this).hasClass("disabled")?!1:($(this).hasClass("basket-link")?(c.id=d.data("id"),c.price=parseInt(d.find(".goods-price").text()),c.originPrice=parseInt(d.find(".goods-price").attr("data-price")),c.title=d.find(".goods-title").text(),c.subtitle=d.find(".goods-description").text(),c.image=d.find(".goods-img img").attr("src"),d.addClass("picked"),f.find(".btn-remove").trigger("click")):(c.id=parseInt(e.data("id")),c.price=parseInt(e.find(".item-price").text()),c.originPrice=parseInt(e.find(".item-price").attr("data-price")),c.title=e.find(".main-title").text(),c.subtitle=e.find(".acessory-title").text(),c.image=e.find(".increase-photo img").attr("src"),c.size=parseInt(e.find(".option-complect").attr("data-id")||c.size),c.pillowcasesCount=parseInt(e.find(".option-pillowcase").text()),c.count=parseInt(e.find(".counter-value").text()),c.isGum=e.find(".input-checkbox").is(":checked"),g.find(".btn-remove").trigger("click")),a.add(c.id,c.image,c.title,c.subtitle,c.size,c.pillowcasesCount,c.isGum,c.count,c.price,c.originPrice,!1),void $(".order-btn").prop("disabled",!0).addClass("order-btn-dis"))}),$(".basket-goods").on("click",".btn-remove",function(){var b=$(this).parents(".item-good");goodsCount=b.siblings(".item-good").length,0===goodsCount&&$(this).parents(".modal-body").prev().trigger("mousedown"),b.slideUp("fast",function(){$(this).remove(),a.totalValue()}),a.remove(b.data("id"))})}a.prototype.add=function(a,b,c,d,e,f,g,h,i,j,k){var l=$("#basket-good-cloned").clone().removeAttr("id").attr("data-id",a);k&&void 0!==k||this.goodsCount++,l.find(".item-image img").attr("src",b),l.find(".item-title").text(c),l.find(".item-subtitle").text(d),l.find(".dropdown-menu").attr("data-id",e),l.find(".dropdown-placeholder").text(l.find('.dropdown-item[data-id="'+e+'"]').text()),l.find(".counter-pillowcases .counter-value").text(f),l.find(".counter-count .counter-value").text(h+" шт."),l.find(".input-checkbox").prop("checked",g),l.find("#is_gum_").attr("id","is_gum_"+a),l.find(".styled-checkbox").attr("for","is_gum_"+a),l.prependTo(".basket-goods").css("display","block"),l.find(".item-price").text(i+" грн.").attr("data-price",j),this.setMainMenuCounter(this.goodsCount),this.setBasketTitleCounter(this.goodsCount),k||this.setData({id:a,image:b,title:$.trim(c),subtitle:d,size:e,pillowcasesCount:f,isGum:g,count:h,price:i,originPrice:j}),this.totalValue()},a.prototype.remove=function(a){this.goodsCount--,this.setMainMenuCounter(this.goodsCount),this.setBasketTitleCounter(this.goodsCount),delete this.goods[a],localStorage.setItem("count",this.goodsCount),localStorage.setItem("goods",JSON.stringify(this.goods)),$(".goods-item[data-id="+a+"]").removeClass("picked"),0===this.goodsCount?$(".modal-basket").addClass("basket-empty"):this.goodsCount>0&&$(".modal-basket").removeClass("basket-empty")},a.prototype.getData=function(){return Modernizr.localstorage?{count:localStorage.getItem("count")||0,goods:localStorage.getItem("goods")||{}}:!1},a.prototype.setData=function(a){return Modernizr.localstorage?(this.goods[a.id]=a,localStorage.setItem("count",this.goodsCount),void localStorage.setItem("goods",JSON.stringify(this.goods))):!1},a.prototype.setMainMenuCounter=function(a){return this.mainMenuCounter.attr("data-count",parseInt(a))},a.prototype.getMainMenuCounter=function(a){return a=void 0===a?!0:!1,a?parseInt(this.mainMenuCounter.attr("data-count")):this.mainMenuCounter},a.prototype.setBasketTitleCounter=function(a){a>0&&10>a?this.basketTitleCounter.text("0"+a):this.basketTitleCounter.text(a)},a.prototype.getBasketTitleCounter=function(a){return a=void 0===a?!0:!1,a?parseInt(this.basketTitleCounter.text()):this.basketTitleCounter},a.prototype.calcGoodSum=function(a){var b=a.hasClass("item-good"),c=a.find(".input-checkbox"),d={},e={complect:a.find(".dropdown-menu.option-complect").attr("data-sum"),pillowcasesCount:a.find(b?".counter-pillowcases":".option-pillowcase").attr("data-sum"),gum:c.prop("checked")?a.find(".input-checkbox").attr("data-price"):0,price:a.find(".item-price").attr("data-price")},f=parseInt(a.find(".good-count .counter-value").text()),g=0;for(key in e)g+=parseInt(e[key]);e.count=parseInt(a.find(".good-count").attr("data-sum")),a.find(".item-price").text(g*f+" грн."),b&&(d={id:a.data("id"),image:a.find(".item-image img").attr("src"),title:a.find(".item-title").text(),subtitle:a.find(".item-subtitle").text(),size:parseInt(a.find(".option-complect").attr("data-id")),pillowcasesCount:parseInt(a.find(".counter-pillowcases .counter-value").text()),isGum:a.find(".input-checkbox").is(":checked"),count:parseInt(a.find(".counter-count").text()),price:parseInt(a.find(".item-price").text()),originPrice:parseInt(a.find(".item-price").attr("data-price"))},this.setData(d),this.totalValue())},a.prototype.totalValue=function(){var a=$(".modal-body"),b=a.find(".total-order"),c=a.find(".item-good"),d=0,e=function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};c.each(function(){d+=parseInt($(this).find(".item-price").text())}),b.text(" "+e(d)+" грн.")};var b=new a,c={index:function(){console.log("Index page loaded!"),function(){var a=$(".goods-slider");a.slick({slidesToShow:4,slidesToScroll:1})}()},good:function(){!function(){var a=$(".photos-slider");a.slick({slidesToShow:3,slidesToScroll:1})}()}},d={page:document.body.id||void 0,lang:document.documentElement.lang||void 0,formValidator:function(a){var b=a.find(".form-input, .form-textarea, .dropdown-menu"),c=b.length,d=0,e=function(a,b){return b?a.removeClass("invalid").addClass("valid"):a.removeClass("valid").addClass("invalid"),b},f=function(a){var b,c="";return a.hasClass("form-input")||a.hasClass("form-textarea")?(c=a.attr("pattern"),e(a,new RegExp(c,"g").test(a[0].value))):a.hasClass("dropdown-menu")?(b=a.children(".dropdown-placeholder"),e(a,b.text()!==b.attr("data-placeholder"))):void 0};return b.each(function(a){var b=f($(this));b?d++:null}),c!==d?(b.keyup(function(){f($(this))}),b.find(".dropdown-item").click(function(){f($(this).parents(".dropdown-menu"))}),!1):!0},eachPage:function(){var a=this;$('[type="tel"]').mask("+380 99 999-99-99"),function(){$(document).on("mouseover",".dropdown-menu",function(){$(this).children(".dropdown-nav").show(),$(this).addClass("hover")}),$(document).on("mouseout",".dropdown-menu",function(){$(this).children(".dropdown-nav").hide(),$(this).removeClass("hover")}),$(document).on("click",".dropdown-item",function(a){var c=$(this).parent(),d=$(this).parents(".dropdown-menu"),e=$(this).parents(".item-good"),f=$(this).parents(".good-specific");a.preventDefault(),d.attr("data-id",$(this).data("id")),$(this).parents(".header").length||c.prev().text($(this).text()).end().hide(),d.attr("data-sum",$(this).data("price")),e.length?b.calcGoodSum(e):b.calcGoodSum(f)})}(),function(){var a=$(".list-item"),b=$(".good-options .dropdown-item");b.click(function(){var b=$(this).data("sizes");a.find("#duvet").text(b.duvet),a.find("#sheet").text(b.sheet),a.find("#pillowcases").text(b.pillowcases)})}(),function(){var c,d=$("#modal-overlay"),e=$(".call-modal"),f=!0,g=function(a){var e=$(a);return"#basket-modal"===a&&0==b.goodsCount?!1:(c=e,void d.fadeIn(150,function(){e.fadeIn(200,function(){f=!1})}))},h=function(){c.fadeOut(150,function(){d.fadeOut(100,function(){f=!0})})};e.click(function(a){a.preventDefault(),g(this.getAttribute("data-target"))}),d.add(".modal-close").mousedown(function(){h()}),$(".modal").submit(function(){return a.formValidator($(this))?!1:!1})}(),function(){$(document).on("click",".btn-dec, .btn-inc",function(){var a=$(this).parents(".item-good"),c=a.length,d=c?a:$(this).parents(".good-specific"),e=$(this).parents(".component-counter"),f=$(this).siblings(".counter-value"),g=$(this).hasClass("btn-dec")?$(this):$(this).siblings(".btn-dec"),h=$(this).hasClass("btn-inc")?$(this):$(this).siblings(".btn-inc"),i=f.text(),j=i.replace(/[0-9]/g,""),k=parseInt(i),l=f.data("min"),m=f.data("max"),n="",o=d.find(".item-price");return $(this).hasClass("btn-dec")?(k>l&&(n=--k),k===l?g.addClass("disabled"):m>k&&h.removeClass("disabled")):(m>k&&(n=++k),k===m?h.addClass("disabled"):k>l&&g.removeClass("disabled")),""===n?!1:(f.text(n+j),c&&e.hasClass("counter-pillowcases")?e.attr("data-sum",(k-2)*f.data("price")):e.attr("data-sum",k*o.data("price")),void b.calcGoodSum(d))})}(),function(){$(document).on("click",".input-checkbox",function(){var a=$(this).parents(".item-good"),c=$(this).parents(".good-specific");a.length?b.calcGoodSum(a):b.calcGoodSum(c)})}()},init:function(){console.log("Main class init! Page lang is "+this.lang+", id = "+this.page),void 0!==this.page&&void 0!==c[this.page]&&c[this.page](),this.eachPage()}};$(function(){d.init()})}();